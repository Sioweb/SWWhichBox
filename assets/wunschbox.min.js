!function(t,e){t(function(){function a(a){a.find("a.granting").click(function(a){var n=t(this);a.preventDefault(),t.ajax({type:"POST",url:"ajax.php",data:{toggleGrant:1,whish:n.data("whish"),REQUEST_TOKEN:e.request_token},success:function(e){e&&n.html(t(t.parseJSON(e).content))}})}),t(window).scroll(function(){}),a.find("a.artistSong").click(function(a){var n=t(this),i=n.parents("[id^=whish_]").eq(0).data("artistsong");a.preventDefault(),t.ajax({type:"POST",url:"ajax.php",data:{toggleArtistSong:1,whish:n.data("whish"),REQUEST_TOKEN:e.request_token},success:function(e){e&&t('[data-artistsong="'+i+'"] a.artistSong').html(t(t.parseJSON(e).content))}})}),a.find("li").click(function(a){var n=!1,i="",s=t(this).parents("[id^=whish_]").eq(0);t(this).is(".artist,.song")&&(a.stopPropagation(),u&&(u.html(p),u=p=!1),u=t(this),p=u.html(),n=u.children("span")[0].outerHTML,i=u.contents().eq(1).text(),u.html(""),t(n).appendTo(u),t('<input type="text" data-typo="'+i+'" name="corectTypo" value="'+i+'">').appendTo(u),t(this).find("input").click(function(t){t.stopPropagation()}).keyup(function(a){var n=t(this);"13"==a.keyCode&&(a.preventDefault(),u.html(p.replace(n.data("typo"),n.val())),t.ajax({type:"POST",url:"ajax.php",data:{updateTypo:1,type:u.data("type"),search:n.data("typo"),replace:n.val(),whish:s.data("whish"),REQUEST_TOKEN:e.request_token},success:function(e){s.find("a.artistSong").html(t(t.parseJSON(e).content))}}),u=p=!1)}))})}function n(){if(c){var e=l.find("li.artist").text().split(":"),a=l.find("li.song").text().split(":");t("title").html(e[1]+": "+a[1])}else t("title").html(d);c=!c}function i(){r++,l&&n(),30>r&&o||(r=0,o&&o.abort(),o=t.ajax({type:"POST",url:"ajax.php",data:{getNewWhishes:1,pageid:m.data("pageid"),filter:m.data("filter"),count:y.val()*g,REQUEST_TOKEN:e.request_token},success:function(e){var n=null,i=m.find("[id^=whish_]").first().prev();i.nextAll().remove(),n=t(t.parseJSON(e).content).insertAfter(i),a(n),n.eq(0).attr("id")!=w&&(l=n.eq(0))}}))}function s(a,n,i){var s=arguments[3]||{};switch(""==a.val()&&(t("body > "+i).remove(),v=!1),n.keyCode){case 13:a.val(k.eq(T).text()),n.preventDefault(),S&&S.remove();break;case 40:if(!k)break;T++,T>k.length-1&&(T=0),k.removeClass("active").eq(T).addClass("active");break;case 38:if(!k)break;T--,0>T&&(T=k.length-1),k.removeClass("active").eq(T).addClass("active");break;default:h&&h.abort(),""!=a.val()&&(h=t.ajax({type:"POST",url:"ajax.php",data:t.extend(s,{value:a.val(),REQUEST_TOKEN:e.request_token}),success:function(e){t("body > "+i).remove(),S=t(t.parseJSON(e).content).appendTo("body").css({top:a.offset().top+a.height()+10,left:a.offset().left,width:a.width()-14}),k=S.find("li"),k.click(function(){a.val(t(this).text()),S.remove()}),S.click(function(t){t.preventDefault(),t.stopPropagation()}),v=!0}}))}}var o=!1,r=0,c=!1,l="",d=t("title").html(),h=!1,f=!1,u=!1,p=!1,v=!1,g=1,m=t("#newWhishes"),y=t(".whish_count select"),w="undefined"!=typeof t("#newWhishes")[0]?t("#newWhishes").children().eq(0).attr("id"):null;t(window).focus(function(){t("title").html(d),l=!1,w=t("#newWhishes").children("div").eq(0).attr("id")}),"undefined"!=typeof m[0]&&(i(),f=setInterval(i,2e3),t(".whish_filter li").click(function(){var n=t(this),i=m.find("[id^=whish_]").first().prev();"undefined"==typeof i[0]&&(i=m.children().last()),t(".whish_filter .active").removeClass("active"),n.addClass("active"),m.data("filter",n.data("filter")),t.ajax({type:"POST",url:"ajax.php",data:{getNewWhishes:1,pageid:m.data("pageid"),filter:m.data("filter"),count:y.val()*g,REQUEST_TOKEN:e.request_token},success:function(e){i.nextAll().remove(),data=t(t.parseJSON(e).content).insertAfter(i),a(data)}})}),y.change(function(){var n=(t(this),m.find("[id^=whish_]").first().prev());"undefined"==typeof n[0]&&(n=m.children().last()),t.ajax({type:"POST",url:"ajax.php",data:{getNewWhishes:1,pageid:m.data("pageid"),count:y.val()*g,REQUEST_TOKEN:e.request_token},success:function(e){n.nextAll().remove(),data=t(t.parseJSON(e).content).insertAfter(n),a(data)}})})),t(document.body).click(function(){t("body > .mod_artist,body > .mod_songs").remove(),v=!1,u&&(u.html(p),u=p=!1)}),t(window).keydown(function(t){return 13==t.keyCode&&v?(t.preventDefault(),!1):void 0});var k=!1,T=-1,S=!1;t('[name="Interpret"]').focus(function(){t(this).attr("autocomplete","off")}).keyup(function(e){s(t(this),e,".mod_artist",{getArtists:1})}),t('[name="Lied"]').focus(function(){t(this).attr("autocomplete","off")}).keyup(function(e){s(t(this),e,".mod_songs",{getSongs:1})})})}(jQuery,Contao);